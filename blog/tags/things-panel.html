<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">3 posts tagged with &quot;ThingsPanel&quot; | ThingsPanel</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.thingspanel.io/blog/tags/things-panel"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="3 posts tagged with &quot;ThingsPanel&quot; | ThingsPanel"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.thingspanel.io/blog/tags/things-panel"><link data-rh="true" rel="alternate" href="https://www.thingspanel.io/blog/tags/things-panel" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.thingspanel.io/zh-Hans/blog/tags/things-panel" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.thingspanel.io/blog/tags/things-panel" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ThingsPanel RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ThingsPanel Atom Feed">



<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-18JL3B13JT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-18JL3B13JT",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.452a291e.css">
<link rel="preload" href="/assets/js/runtime~main.e8aed882.js" as="script">
<link rel="preload" href="/assets/js/main.7cd9b11b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/dark.svg" alt="ThingsPanel" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="ThingsPanel" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/docs/overview">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link icon-link language navbar__item"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/blog/tags/things-panel" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-Hans/blog/tags/things-panel" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/ThingsPanel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/script">ThingsPanel 非官方标准MQTT协议设备接入</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thingspanel-ver0.3.0-release">ThingsPanel-0.3.0 was released, adding a rule engine, a permission system, and optimizing device access</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thingspanel-app">ThingsPanel releases IoT mobile client (multi-image)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>3 posts tagged with &quot;ThingsPanel&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/script">ThingsPanel 非官方标准MQTT协议设备接入</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-31T00:00:00.000Z" itemprop="datePublished">January 31, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/hezhuozhuo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/61645647?s=64&amp;v=4" alt="hezhuo"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/hezhuozhuo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">hezhuo</span></a></div><small class="avatar__subtitle" itemprop="description">极益科技</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="问题">问题<a href="#问题" class="hash-link" aria-label="Direct link to 问题" title="Direct link to 问题">​</a></h2><ol><li><p>mqtt设备/网关<code>发送和订阅主题</code>与平台不一致并无法修改，怎么接入ThingsPanel平台?</p></li><li><p>mqtt设备/网关<code>json报文规范</code>与平台规范不一致，怎么接入ThingsPanel平台?</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用规则引擎转发设备数据">使用规则引擎转发设备数据<a href="#使用规则引擎转发设备数据" class="hash-link" aria-label="Direct link to 使用规则引擎转发设备数据" title="Direct link to 使用规则引擎转发设备数据">​</a></h2><p>使用规则引擎转发设备数据的方式常用来解决第一种问题。</p><ol><li>在规则引擎中新建一条接入规则</li><li>拖拽一个<code>mqtt in</code>节点，填写设备主题接入数据</li><li>再拖拽一个<code>mqtt out</code>节点，与<code>mqtt in</code>节点连线</li><li>在<code>mqtt out</code>配置中需要添加新的mqtt-broker节点，根据平台mqtt网关/设备接入规则填写主题和认证方式（AccessToken接入填写用户名,MQTTBasic认证填写用户名和密码）</li><li>平台到设备的通信参考以上步骤</li><li>除了以上节点，合理使用其他功能节点，也可以转换报文规范并对设备传输的值加工和处理</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用编辑参数页面的数据处理脚本功能">使用编辑参数页面的<code>数据处理脚本</code>功能<a href="#使用编辑参数页面的数据处理脚本功能" class="hash-link" aria-label="Direct link to 使用编辑参数页面的数据处理脚本功能" title="Direct link to 使用编辑参数页面的数据处理脚本功能">​</a></h2><p>数据处理脚本功能可解决第二种问题，它的原理相当于中间件。</p><ol><li>创建设备后，点击编辑参数，在数据处理下拉框选择<code>自定义协议</code></li><li>在弹出的<code>自定义数据解析脚本</code>对话框中输入<code>上行解析脚本</code>和<code>下行解析脚本</code></li><li>保存后创建其他同类设备的时候可以直接选择解析脚本</li><li>数据处理脚本通常还可对设备传输的值做加工处理</li><li>具体细节可以参考下面提供给的解析案例</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="案例">案例<a href="#案例" class="hash-link" aria-label="Direct link to 案例" title="Direct link to 案例">​</a></h2><p>网关设备平台规范报文：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TH180001&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;temp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;hum&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TH180002&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;temp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;hum&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>非规范设备报文：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;sensorDatas&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;TH180001&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;temp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">265</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;hum&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;TH180002&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;temp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">265</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;hum&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上行解析脚本为例：</p><ol><li>分析发现设备发来的报文多了一层嵌套，并且数值都未做处理</li><li>创建网关设备，添加两个子设备。（注意子设备地址在编辑参数中填写，同一网关中不可重复，如下图） <img loading="lazy" src="/assets/images/compatible_device_02-f21109405ff9dd991408ea29f9ad7609.png" width="2560" height="1297" class="img_ev3q"></li><li>首先编写代码<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> device_msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;sensorDatas&quot;:{&quot;TH180001&quot;:{&quot;temp&quot;:265,&quot;hum&quot;:455},&quot;TH180002&quot;:{&quot;temp&quot;:26.5,&quot;hum&quot;:45.5}},&quot;type&quot;:2}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> public_topic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gateway/attributes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">encodeInp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">device_msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">public_topic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">encodeInp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">msg</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> topic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 将设备自定义msg（自定义形式）数据转换为json形式数据, 设备上报数据到物联网平台时调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 入参：topic string 设备上报消息的 topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 入参：msg byte[] 数组 不能为空</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 出参：string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 处理完后将对象转回字符串形式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 例，byte[]转string：var msgString = String.fromCharCode.apply(null, msg);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 例，string转jsonObj：msgJson = JSON.parse(msgString);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 例，jsonObj转string：msgString = JSON.stringify(msgJson);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> msgString </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fromCharCode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gateway/attributes&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> jsonObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msgString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        newObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jsonObj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sensorDatas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> newObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> k </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> newObj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                newObj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newObj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newObj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>使用在线js调试工具,这里用的是：<a href="https://www.lddgo.net/code/runcode/javascript" target="_blank" rel="noopener noreferrer">https://www.lddgo.net/code/runcode/javascript</a> <img loading="lazy" src="/assets/images/compatible_device_01-54a5cf338fe8323e4aebea0d87cf7683.png" width="2560" height="1297" class="img_ev3q"></li><li>调试好以后，将函数粘贴进脚本保存（脚本在网关的编辑参数中，如图） <img loading="lazy" src="/assets/images/compatible_device_03-5d15e42e6967fca2e781c2b8c57f2c93.png" width="2560" height="1297" class="img_ev3q"> <img loading="lazy" src="/assets/images/compatible_device_04-4124f23bf20e07e0fd8641d71dfd6f5c.png" width="2560" height="1297" class="img_ev3q"></li><li>下行脚本的编写也同上</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/things-panel">ThingsPanel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/mqtt">MQTT</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/thingspanel-ver0.3.0-release">ThingsPanel-0.3.0 was released, adding a rule engine, a permission system, and optimizing device access</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-08-15T00:00:00.000Z" itemprop="datePublished">August 15, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zjhong" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/61645647?s=64&amp;v=4" alt="zjhong"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zjhong" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zjhong</span></a></div><small class="avatar__subtitle" itemprop="description">Jiyi Technology</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="release-notes">Release notes<a href="#release-notes" class="hash-link" aria-label="Direct link to Release notes" title="Direct link to Release notes">​</a></h2><p>This release revises many of the questions raised by previous users, especially the management of large-scale devices, access to complex devices, and how to efficiently forward data to third parties.In addition, this time it is also an overall test of performance, simulating 10,000 devices to stress test the system, and achieving a single TimescaleDB node 5000 devices/s access capability (4 cores 8G).In terms of permissions, horizontal fine to the operation and button, a relatively complete RBAC permission support has been established.Of course, it also includes a lot of detail improvements.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-demo">System demo<a href="#system-demo" class="hash-link" aria-label="Direct link to System demo" title="Direct link to System demo">​</a></h2><p>Demo address：<a href="http://dev.thingspanel.cn" target="_blank" rel="noopener noreferrer">http://dev.thingspanel.cn</a></p><p>Account password</p><ul><li>User name：<a href="mailto:admin@thingspanel.cn" target="_blank" rel="noopener noreferrer">admin@thingspanel.cn</a></li><li>Password：123456</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-new">What&#x27;s new<a href="#whats-new" class="hash-link" aria-label="Direct link to What&#x27;s new" title="Direct link to What&#x27;s new">​</a></h2><ul><li>Added Redis as a caching module</li><li>Added RBAC permission management module, using the Casbin permission framework, and the granularity of permissions is specific to devices, buttons or interfaces</li></ul><p><img loading="lazy" src="/assets/images/2022-08-15-11-25-27-edcc0589a23120a34297081a4ca00b08.png" width="1920" height="942" class="img_ev3q"></p><ul><li>Added a role management page to support multiple roles.</li></ul><p><img loading="lazy" src="/assets/images/2022-08-15-11-28-22-ef641defb0c7ef82e37eff61dec239b5.png" width="2736" height="1548" class="img_ev3q"></p><ul><li>Added a permission management page, permissions fine-grained to the operation.</li></ul><p><img loading="lazy" src="/assets/images/2022-08-15-11-29-21-07cf8310aba9a9d2182610e9b595c74c.png" width="1920" height="942" class="img_ev3q"></p><ul><li>The system backend adds support for Docker environment variables for easy configuration.</li><li>Simplified deployment and increased adaptation to HUAWEI CLOUD / Alibaba Cloud.</li><li>Added access rule engine and data forwarding function.</li></ul><p><img loading="lazy" src="/assets/images/2022-08-15-11-30-05-615543ea96b534fc116214c3caa54679.png" width="1920" height="942" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/2022-08-15-11-30-15-f7ad6ee09cb2ad7f29898a1d6d5c087a.png" width="1920" height="942" class="img_ev3q"></p><ul><li>Rewritten Business - Device Grouping - Device Module, supporting unlimited device grouping</li></ul><p><img loading="lazy" src="/assets/images/2022-08-15-11-30-50-c66dceb356a3b33ff680550f2bef2a24.png" width="1920" height="942" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/2022-08-15-11-30-59-4609e9396e966f1dea780ef3b283bee9.png" width="911" height="435" class="img_ev3q"></p><ul><li>Added log of operation device, support query manual operation and automatic operation records</li></ul><p><img loading="lazy" src="/assets/images/2022-08-15-11-31-15-05ace52bf2c3aa8873d76e1d9c768a2c.png" width="1920" height="942" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimization-and-fixing">Optimization and fixing<a href="#optimization-and-fixing" class="hash-link" aria-label="Direct link to Optimization and fixing" title="Direct link to Optimization and fixing">​</a></h2><ul><li>Optimized first login loading speed.</li><li>Optimized the overall UI.</li><li>Optimized indexing and sorting of some tables to improve the fluency of operations.</li><li>The standard of stress testing has been raised and various aspects of performance and structure have been optimized.</li><li>Optimized automated alerting and control strategies.</li><li>User added features and pages rewritten.</li><li>Optimized the alarm information page.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-next-release-is-scheduled">The next release is scheduled<a href="#the-next-release-is-scheduled" class="hash-link" aria-label="Direct link to The next release is scheduled" title="Direct link to The next release is scheduled">​</a></h2><p>The next version, number 0.4.0, is functionally planned to learn from HomeAssistant, implement a more open structure, increase the group of shared chart components, and make the development of plug-ins simpler and more efficient plug-in development.The major structural issues that existed before ThingsPanel will be improved, especially on large integration projects, and the efficiency will be very prominent.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/things-panel">ThingsPanel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rule-engine">Rule engine</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/permission-system">Permission system</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/performance-testing">Performance testing</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/thingspanel-app">ThingsPanel releases IoT mobile client (multi-image)</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-22T00:00:00.000Z" itemprop="datePublished">July 22, 2022</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zjhong" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/61645647?s=64&amp;v=4" alt="zjhong"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zjhong" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zjhong</span></a></div><small class="avatar__subtitle" itemprop="description">Jiyi Technology</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ThingsPanel is an underlying open source software of the Internet of Things, the main function is to collect device data, visualization, automation control, for many integrators, equipment vendors, solution providers to provide rapid product and delivery solutions.</p><p>ThingsPanel&#x27;s mobile app is used to provide mobile management and control support to ThingsPanel.The main implemented functions include monitoring, control, policy, and device addition management.Is a lightweight client for ThingsPanel that supports SAAS scenarios.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="features-on-the-mobile-phone-include">Features on the mobile phone include：<a href="#features-on-the-mobile-phone-include" class="hash-link" aria-label="Direct link to Features on the mobile phone include：" title="Direct link to Features on the mobile phone include：">​</a></h2><ul><li>Using Uniapp development, it can be easily compiled into iOS, Android, WeChat Mini Program and other Mini Programs, H5.</li><li>You can scan the code to add a device (the device needs to be imported in the background first).</li><li>View the monitoring values.</li><li>切换智能化项目和设备分组。</li><li>Manual control.</li><li>set the control policy,</li><li>There are two types: device trigger and time condition trigger.</li><li>Review the operation log.</li><li>Personal account management function.</li><li>Mobile phone verification code login.</li></ul><p>ThingsPanel-APP mobile client login page <img loading="lazy" alt="ThingsPanel-APP landing page" src="/assets/images/thingspanel-app-login-c0f332e33ebb51113ab0296a79a29d71.webp" width="519" height="1031" class="img_ev3q"></p><p>ThingsPanel-APP Home <img loading="lazy" alt="ThingsPanel-APP" src="/assets/images/thingspanel-app-home-519993a05bd1fdc486ffef36daba299a.webp" width="519" height="1031" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/things-panel">ThingsPanel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/app">APP</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.e8aed882.js"></script>
<script src="/assets/js/main.7cd9b11b.js"></script>
</body>
</html>